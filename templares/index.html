<!DOCTYPE html>
<html>

<head>
    <title>Graph Route</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Ancizar+Serif:ital,wght@0,300..900;1,300..900&family=Emilys+Candy&family=Irish+Grover&family=Send+Flowers&display=swap"
        rel="stylesheet">
    <link rel="icon" href="../static/f.jpg">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Leaflet CSS for map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <style>
        body,
        button,
        h1 {
            font-family: 'Ancizar Serif', serif;
        }

        /* Ensure map container has a height */
        #map-container {
            height: 420px;
            width: 100%;
        }

        /* Centered box used for route & places list */
        .center-box {
            max-width: 760px;
            margin: 24px auto;
            padding: 8px 16px;
            text-align: center;
        }

        /* Places list: compact centered grid, NOT full width */
        #places-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px;
            max-width: 720px;
            margin: 18px auto 0 auto;
            justify-items: center;
            background-color: white;
            padding: 50px;
            border-radius: 30px;
            background-image: url("../static/bg1.png");
            background-size: cover;
        }

        .place-btn {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            background-color: white;
            /* Ensures white background */
            color: black;
            /* Ensures black text */
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.04);
            font-family: 'Ancizar Serif', serif;
        }

        .place-btn:hover {
            transform: translateY(-2px);
            transition: .12s;
            background-color: #f9f9f9;

        }

        /* Gallery overlay */


        .gallery-media {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            justify-content: center;
        }

        .gallery-image {
            width: 720px;
            max-width: calc(100% - 140px);
            height: 460px;
            object-fit: cover;
            border-radius: 8px;
            background: #f3f3f3;
        }

        .arrow-btn {
            background: transparent;
            border: none;
            font-size: 34px;
            cursor: pointer;
            user-select: none;
        }

        .gallery-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .gallery-card {
            position: relative;
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            max-width: 80%;
            max-height: 90%;
        }

        .close-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            font-size: 20px;
            border-radius: 50%;
            cursor: pointer;
            padding: 5px 10px;
            line-height: 1;
        }

        .close-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }


        /* blur the places list when the gallery is open */
        #places-list.blurred {
            filter: blur(4px) brightness(0.9);
            pointer-events: none;
            user-select: none;
        }

        /* small-device tweaks */
        @media (max-width: 800px) {
            .gallery-image {
                height: 320px;
            }

            .arrow-btn {
                font-size: 28px;
            }
        }

        /* Center cities list */
        .places-list {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            max-width: 300px;
            margin: 0 auto;
        }

        /* Gallery overlay background */
        .gallery-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        /* Gallery card */
        .gallery-card {
            position: relative;
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            max-width: 80%;
            max-height: 90%;
        }

        /* Close button */
        .close-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            font-size: 20px;
            border-radius: 50%;
            cursor: pointer;
            padding: 5px 10px;
            line-height: 1;
        }

        .close-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .prev,
        .next {
            color: white;
            /* Or any visible color */
            font-size: 2rem;
            cursor: pointer;
            user-select: none;
        }

        .center-box {
            text-align: center;
            padding: 20px;
        }

        /* Places list buttons */
        #places-list button {
            margin: 5px;
            padding: 10px 15px;
            background-color: #2c3e50;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #places-list button:hover {
            background-color: #34495e;
        }

        /* Gallery overlay */
        .gallery-overlay {
            display: none;
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
        }

        .gallery-card {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            background: #fff;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        /* Close button - top right */
        .close-btn {
            position: absolute;
            top: 8px;
            right: 12px;
            background: transparent;
            border: none;
            font-size: 28px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
        }

        .close-btn:hover {
            color: red;
        }

        /* Gallery media container */
        .gallery-media {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .gallery-image {
            max-width: 80vw;
            max-height: 70vh;
            border-radius: 6px;
        }

        /* Arrow buttons */
        .arrow-btn {
            background: transparent;
            border: none;
            font-size: 48px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            padding: 0 15px;
            user-select: none;
        }

        .arrow-btn:hover {
            color: #f39c12;
        }

        /* Caption */
        #gallery-caption {
            margin-top: 8px;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>

<body>

    <header class="navbar">
        <div class="nav-title" style="color: burlywood; margin-left: 0px;"> <img src="../static/f.jpg" alt="logo"
                height="30px" width="30px" style="margin-top: 2px;">
            GRAPH ROUTE</div>
        <nav class="nav-links">
             <button onclick="showSection('route')" style="font-size: 20px;">Маршрут</button>
             <button onclick="showSection('map')" style="font-size: 20px;">Карта</button>
             <button onclick="showSection('place')" style="font-size: 20px;">Места</button>
        </nav>
    </header>

    <!-- ROUTE SECTION -->
    <div id="route-section" class="container">
        <h1 style="color: #2c3e50;">GRAPH ROUTE</h1>

        <label for="start" style="font-size: 20px;">Город отправления:</label>
        <select id="start">
            {% for city in cities %}
            <option value="{{ city }}" {% if city==start %}selected{% endif %}
                style="font-family: 'Ancizar Serif', serif;">{{ city }}</option>
            {% endfor %}
        </select>

        <label for="end" style="font-size: 20px;">Город назначения:</label>
        <select id="end">
            {% for city in cities %}
            <option value="{{ city }}" {% if city==end %}selected{% endif %}
                style="font-family: 'Ancizar Serif', serif;">{{ city }}</option>
            {% endfor %}
        </select>

        <label for="algo" style="font-size: 20px;">Алгоритм:</label>
        <select id="algo">
            <option value="bfs">BFS</option>
            <option value="dfs">DFS</option>
            <option value="astar">A*</option>
        </select>

        <button onclick="findRoute()">Найти маршрут</button>

        <div id="output"></div>
    </div>


    <!-- MAP SECTION -->
    <div id="map-section" class="container" style="display:none;">
        <h1 style="color:#2c3e50;">Карта</h1>
        <div id="map-container"></div>
    </div>

    <!-- PLACES SECTION -->
    <div id="place-section" class="center-box" style="display:block; margin-top: 70px;">
        <h1 style="color:#ccc; margin-bottom:6px; background-color:#2c3e50; padding:8px;">Места</h1>

        <!-- List of city buttons -->
        <div id="places-list" aria-label="Places list"></div>

        <!-- Gallery overlay -->
        <div id="gallery-overlay" class="gallery-overlay" role="dialog" aria-modal="true">
            <div class="gallery-card" id="gallery-card">
                <button class="close-btn" id="gallery-close" title="Закрыть (Esc)"
                    style="margin-top: 15px; padding-left: 50px;">✕</button>
                <h3 id="gallery-title" style="margin:6px 0 10px 0;"></h3>
                <div class="gallery-media">
                    <button class="arrow-btn" id="gallery-prev" title="Назад (←)">&#10094;</button>
                    <img id="gallery-image" class="gallery-image" src="" alt="City image" style="margin-top: 20px;">
                    <button class="arrow-btn" id="gallery-next" title="Далее (→)">&#10095;</button>
                </div>
                <div id="gallery-caption"></div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS for map -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <script>
        function findRoute() {
            const start = document.getElementById("start").value;
            const end = document.getElementById("end").value;
            const algorithm = document.getElementById("algo").value;

            fetch("/get-route", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ start, end, algorithm })
            })
                .then(res => res.json())
                .then(data => {
                    const output = document.getElementById("output");
                    output.innerHTML = "";

                    if (data.note) {
                        output.innerHTML += `<p><strong>Примечание:</strong> ${data.note}</p>`;
                    }

                    if (data.path && data.path.length > 0) {
                        output.innerHTML += `<p><strong>Маршрут:</strong> ${data.path.join(" → ")}</p>`;
                        output.innerHTML += `<p><strong>Расстояние:</strong> ${data.cost}</p>`;
                    } else {
                        output.innerHTML += `<p>Маршрут не найден.</p>`;
                    }
                });
        }

        function showSection(section) {
            document.getElementById("route-section").style.display = "none";
            document.getElementById("map-section").style.display = "none";
            document.getElementById("place-section").style.display = "none";

            document.getElementById(section + "-section").style.display = "block";

            if (section === "map") {  // CHANGED: Ensure map resizes and loads correctly
                setTimeout(() => {
                    map.invalidateSize();
                }, 200);
            }
        }

        // Initialize Leaflet map (russia3270 graph: города России)
        let map = L.map('map-container').setView([56.15499737401253, 39.69236650834056], 5); // Центр над Россией
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        function drawRouteOnMap(coords) {
            if (!coords || coords.length === 0) return;
            let latlngs = coords.map(c => [c.lat, c.lng]);
            L.polyline(latlngs, { color: 'blue' }).addTo(map);
            map.fitBounds(latlngs);
        }

        // Show route section by default
        // window.onload = () => showSection('route');
        // ---- PLACES GALLERY ----
        const placeImages = {
            "Mocква": [
                "https://avatars.mds.yandex.net/i?id=51cb3552454e72179b2931a07331666a_l-12991402-images-thumbs&n=13",
                "https://avatars.mds.yandex.net/i?id=7f7d584e77fcfa015d9f18f7201f33c0_l-5251286-images-thumbs&n=13",
                "https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/Red_Square_-_Moscow_2024.jpg/1200px-Red_Square_-_Moscow_2024.jpg"
            ],
            "Санкт-Петербург": [
                "https://i.ytimg.com/vi/ilUPzCADxoA/maxresdefault.jpg",
                "https://www.kino-teatr.ru/news/22060/195907.jpg",
                "https://avatars.mds.yandex.net/i?id=ebbddf73a6ddc52bfe972a61374241db_l-4911453-images-thumbs&n=13"
            ],
            "Нижний Новгород": [
                "https://i.ytimg.com/vi/tBw4-0b5E-0/maxresdefault.jpg",
                "https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/NN_28-08-2021_11.jpg/1200px-NN_28-08-2021_11.jpg",
                "https://i.ytimg.com/vi/zNchnZ4W7QQ/maxresdefault.jpg"
            ],
            "Казань": [
                "https://s1.stc.all.kpcdn.net/russia/wp-content/uploads/2025/01/Dvorets-zemledeltsev-v-Kazani-oblozhka-1.jpg",
                "https://7d9e88a8-f178-4098-bea5-48d960920605.selcdn.net/581d726f-bbf8-4216-87dd-3307ccc916ad/",
                "https://avatars.mds.yandex.net/i?id=7e3efda72d89f821e85f10c20f9fe99403a4a7f2-4758710-images-thumbs&n=13"
            ],
            "Самара": [
                "https://avatars.mds.yandex.net/i?id=4075103ecc12ad8a1eae5d72d2fe2b32_l-5294162-images-thumbs&n=13",
                "https://resize.tripster.ru/xUzCH9nsRJ2QGWU3dahHfHKY7G0=/fit-in/1220x600/filters:no_upscale()/https://cdn.tripster.ru/photos/6915f342-98c8-42cf-a42b-0f3f7b03acdc.jpg",
                "https://cdnstatic.rg.ru/uploads/photogallery/2024/02/12/img_9362_e8d.jpg"
            ],
            "Уфа": [
                "https://avatars.mds.yandex.net/get-vertis-journal/4469561/XXXL_27.webp_1714977111481/1200x1200",
                "https://static.mk.ru/upload/entities/2023/09/07/12/articles/facebookPicture/2d/ab/ad/b7/d8ef39cf7d4c1a5309a9e2527d88371f.jpg",
                "https://cdn.sportmaster.ru/upload/content/mediahab/prod/af43c76b-71aa-4315-a316-113152500ff5.jpg"
                ],


            "Екатеринбург": [
                "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8e/Yekaterinburg-City_%28September_2022%29_-_6.jpg/1200px-Yekaterinburg-City_%28September_2022%29_-_6.jpg",
                "https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Yekaterinburg-overview-april-2015-russia-0001.jpg/1200px-Yekaterinburg-overview-april-2015-russia-0001.jpg",
                "https://www.fantasyway.ru/images/jatoms/tours/36188-ekaterinburg-vstrechaet-gostej/331b262ab71d47afac43f8bd34f8d330.jpeg"
            ],


            "Челябинск": [
                "https://img-fotki.yandex.ru/get/6741/30348152.193/0_80ae1_2b26f682_orig",
                "https://www.susu.ru/sites/default/files/field/image/che-city2.jpg",
                "https://img-fotki.yandex.ru/get/6825/30348152.194/0_80b13_a7317f43_orig"
            ],


            "Омск": [
                "https://triplook.me/media/resorts/photo/c/d/fp6.jpg",
                "https://sdelanounas.ru/i/a/w/1/f_aW1nLmdlbGlvcGhvdG8uY29tL29tc2syMDIwLzMxX29tc2syMDIwLmpwZz9fX2lkPTEzNzUxOQ==.jpeg",
                "https://avatars.mds.yandex.net/i?id=4d9ca49b02394d649e165731e1322f6b_l-4918066-images-thumbs&n=13"
            ],


            "Новосибирск": [          
                "https://avatars.mds.yandex.net/i?id=5d4919cc88afc884d4d6d226167be9bd_l-4571688-images-thumbs&n=13"
            ],


            "Воронеж": [             
                "https://idemvmuzei.ru/storage/exhibition/c3/60/88/d5/64/50/a6/4e/1720758f64c487c4e6059ea5c9a3c6bf_jpg.jpg"
            ],


            "Саратов": [
                "https://sun9-41.userapi.com/impf/u4OV_yZghBGK8NClmPcxY6z8JKBQxVlesW8asg/iYqVZllIatQ.jpg?size=1920x768&quality=95&crop=0,84,1100,439&sign=331396765fd87187490adee8ee558cd5&type=cover_group"
            ],


            "Волгоград": [
                "https://avatars.mds.yandex.net/i?id=49dd976903b29ea6de61b4b2679d3e2a_l-10778769-images-thumbs&n=13"
            ],


            "Ростов-на-Дону": [
                "https://cs15.pikabu.ru/post_img/2024/09/23/6/og_og_1727085002272660474.jpg"
            ],


            "Краснодар": [
                "https://www.onetwotrip.com/ru/blog/wp-content/uploads/2017/07/fc-krasnodar.jpg"
            ],


            "Пермь": [
                "https://ic.pics.livejournal.com/zdorovs/16627846/2086433/2086433_original.jpg",
                "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/2c/cf/ae/d0/caption.jpg?w=1200&h=1200&s=1"
            ]
        };

        let currentCity = "";
        let currentIndex = 0;

        function loadPlacesList() {
            const container = document.getElementById("places-list");
            container.innerHTML = "";
            Object.keys(placeImages).forEach(city => {
                const btn = document.createElement("button");
                btn.innerText = city;
                btn.style.margin = "5px";
                btn.style.color = "black";
                btn.onclick = () => showCityGallery(city);
                container.appendChild(btn);
            });
        }
        // Populate city buttons
        const placesList = document.getElementById("places-list");
        for (let city in placeImages) {
            const btn = document.createElement("button");
            btn.innerText = city;
            btn.onclick = () => showCityGallery(city);
            placesList.appendChild(btn);
        }

        function showCityGallery(city) {
            currentCity = city;
            currentIndex = 0;
            updateGallery();
            document.getElementById("gallery-overlay").style.display = "flex";
        }

        // Update gallery content
        function updateGallery() {
            document.getElementById("gallery-title").innerText = currentCity;
            document.getElementById("gallery-image").src = placeImages[currentCity][currentIndex];
            document.getElementById("gallery-caption").innerText =
                `Фотография ${currentIndex + 1} из ${placeImages[currentCity].length}`;
        }

        // Navigation arrows
        document.getElementById("gallery-prev").onclick = () => {
            currentIndex = (currentIndex - 1 + placeImages[currentCity].length) % placeImages[currentCity].length;
            updateGallery();
        };

        document.getElementById("gallery-next").onclick = () => {
            currentIndex = (currentIndex + 1) % placeImages[currentCity].length;
            updateGallery();
        };

        // Close gallery
        document.getElementById("gallery-close").onclick = () => {
            document.getElementById("gallery-overlay").style.display = "none";
        };

        // Click outside to close
        document.getElementById("gallery-overlay").onclick = (e) => {
            if (e.target.id === "gallery-overlay") {
                document.getElementById("gallery-overlay").style.display = "none";
            }
        };

        // Init
        window.onload = () => {
            showSection('route');
            loadPlacesList();
        };
    </script>
    <!-- Corner watermark -->
    <div class="site-watermark">owner's 3270 students</div>
</body>

</html>
